<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Advanced Programming in R</title>
  <meta name="description" content="Advanced Programming in R">
  <meta name="generator" content="bookdown 0.5.4 and GitBook 2.6.7">

  <meta property="og:title" content="Advanced Programming in R" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="marburg-open-courseware/publication-quality-graphics" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Advanced Programming in R" />
  
  
  

<meta name="author" content="Florian Detsch">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="iteration-procedures.html">
<link rel="next" href="the-apply-family.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Programming in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="towards-a-structured-workflow.html"><a href="towards-a-structured-workflow.html"><i class="fa fa-check"></i><b>1</b> Towards a structured workflow</a><ul>
<li class="chapter" data-level="1.1" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>1.1</b> Git version control</a></li>
<li class="chapter" data-level="1.2" data-path="rproj.html"><a href="rproj.html"><i class="fa fa-check"></i><b>1.2</b> RStudio projects</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-handling-and-visualization.html"><a href="data-handling-and-visualization.html"><i class="fa fa-check"></i><b>2</b> Data handling and visualization</a><ul>
<li class="chapter" data-level="2.1" data-path="summarizing-data.html"><a href="summarizing-data.html"><i class="fa fa-check"></i><b>2.1</b> Summarizing data</a></li>
<li class="chapter" data-level="2.2" data-path="data-format-conversions.html"><a href="data-format-conversions.html"><i class="fa fa-check"></i><b>2.2</b> Data format conversions</a></li>
<li class="chapter" data-level="2.3" data-path="visualizing-data-using-ggplot2.html"><a href="visualizing-data-using-ggplot2.html"><i class="fa fa-check"></i><b>2.3</b> Visualizing data using <strong>ggplot2</strong></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="iteration-procedures.html"><a href="iteration-procedures.html"><i class="fa fa-check"></i><b>3</b> Iteration procedures</a><ul>
<li class="chapter" data-level="3.1" data-path="for.html"><a href="for.html"><i class="fa fa-check"></i><b>3.1</b> <code>for()</code> loops</a></li>
<li class="chapter" data-level="3.2" data-path="the-apply-family.html"><a href="the-apply-family.html"><i class="fa fa-check"></i><b>3.2</b> The <code>*apply</code> family</a><ul>
<li class="chapter" data-level="3.2.1" data-path="the-apply-family.html"><a href="the-apply-family.html#apply"><i class="fa fa-check"></i><b>3.2.1</b> <code>apply()</code></a></li>
<li class="chapter" data-level="3.2.2" data-path="the-apply-family.html"><a href="the-apply-family.html#lapply-and-sapply"><i class="fa fa-check"></i><b>3.2.2</b> <code>lapply()</code> and <code>sapply()</code></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="functional-programming.html"><a href="functional-programming.html"><i class="fa fa-check"></i><b>3.3</b> Functional programming</a><ul>
<li class="chapter" data-level="3.3.1" data-path="functional-programming.html"><a href="functional-programming.html#custom-functions"><i class="fa fa-check"></i><b>3.3.1</b> Custom functions</a></li>
<li class="chapter" data-level="3.3.2" data-path="functional-programming.html"><a href="functional-programming.html#functionals"><i class="fa fa-check"></i><b>3.3.2</b> Functionals</a></li>
<li class="chapter" data-level="3.3.3" data-path="functional-programming.html"><a href="functional-programming.html#closures"><i class="fa fa-check"></i><b>3.3.3</b> Closures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="speeding-up-iteration-procedures.html"><a href="speeding-up-iteration-procedures.html"><i class="fa fa-check"></i><b>4</b> Speeding up iteration procedures</a><ul>
<li class="chapter" data-level="4.1" data-path="parallelization.html"><a href="parallelization.html"><i class="fa fa-check"></i><b>4.1</b> Parallelization</a></li>
<li class="chapter" data-level="4.2" data-path="c-interconnectivity-via-rcpp.html"><a href="c-interconnectivity-via-rcpp.html"><i class="fa fa-check"></i><b>4.2</b> C++ interconnectivity via <strong>Rcpp</strong></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="final-remarks.html"><a href="final-remarks.html"><i class="fa fa-check"></i><b>5</b> Final remarks</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with <b>bookdown</b></a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Programming in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="for" class="section level2">
<h2><span class="header-section-number">3.1</span> <code>for()</code> loops</h2>
<p>Maybe the most important part of any advanced analysis workflow is to avoid (code) repetition. If you need to perform a certain task many times, proper interation structures are far more desirable than the classical copy-and-paste approach.</p>
<p>Why? Because they</p>
<ul>
<li>help you avoid errors (as each copy of any code chunk increases the risk of error introduction);</li>
<li>make debugging a lot easier as you only have to debug once;</li>
<li>make your code a lot shorter and more readable;</li>
<li>save you time coding;</li>
<li>etc.</li>
</ul>
<p>The classical iteration structure is the so-called <code>for</code> loop. Classic, because it is the back-bone of any and all programming languages. The basic concept is simple</p>
<pre><code>for (a certain amount of iterations)
  do this</code></pre>
<p>The way the iteration sequence is specified differs between languages, but the basic principle is always the same. The sequence is usually specified via some placeholder – most popular of which is <code>i</code> for iteration – which usually represents an <code>integer</code> sequence, though you can also iterate over <code>character</code> strings. Here’s a very simple loop:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>) <span class="kw">print</span>(i)</code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5</code></pre>
<p>Make sure you code clearly so that you can easily understand what your code is doing. Therefore, when using iteration structures, try to provide meaningful placeholder names.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (name <span class="cf">in</span> <span class="kw">names</span>(diamonds)) <span class="kw">print</span>(name)</code></pre></div>
<pre><code>## [1] &quot;carat&quot;
## [1] &quot;cut&quot;
## [1] &quot;color&quot;
## [1] &quot;clarity&quot;
## [1] &quot;depth&quot;
## [1] &quot;table&quot;
## [1] &quot;price&quot;
## [1] &quot;x&quot;
## [1] &quot;y&quot;
## [1] &quot;z&quot;</code></pre>
<p>Another way to specify an iteration is via the <code>seq()</code> function which can be used to create a sequence of integers based on the length of an object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="kw">names</span>(diamonds))) <span class="kw">cat</span>(<span class="st">&quot;The class of colom&quot;</span>, i, <span class="st">&quot;is&quot;</span>,  <span class="kw">class</span>(<span class="kw">data.frame</span>(diamonds)[, i]), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre></div>
<pre><code>## The class of colom 1 is numeric 
## The class of colom 2 is ordered factor 
## The class of colom 3 is ordered factor 
## The class of colom 4 is ordered factor 
## The class of colom 5 is numeric 
## The class of colom 6 is numeric 
## The class of colom 7 is integer 
## The class of colom 8 is numeric 
## The class of colom 9 is numeric 
## The class of colom 10 is numeric</code></pre>
<p>Did you spot the spelling mistake in the above example? It is easy to debug this, as we only need to correct the error once, not 10 times.</p>
<p><br><b>Task: Looping the mean, meaning the loop</b></p>
<p>Take the above <code>for</code> loop and modify so that instead of the class it prints out the mean of each column.</p>
<br>
<center>
<img src="https://upload.wikimedia.org/wikipedia/commons/2/25/Hourglass_2.svg" alt="hourglass" style="width: 125px;"/>
</center>
<p><br></p>
<p>Obviously, we are usually not interested in simply printing something to the console (though this can be a great way of keeping track of where you’re computation is in case of long running loops). Most of the time we want to actually run some computations/statistical analyses. The principle remains the same.</p>
<p>You may have heard the notion that <code>for()</code> loops in R are slow and should be avoided. This is true in many situations. As a general rule,</p>
<blockquote>
<p>you should avoid <code>for()</code> loops whenever you want to do calculations on parts of an object. This can be achieved much more efficiently with indexing in R if you have multiple objects and you want to carry out the same operation on each of them or you have one object and want to carry out different types of calculations on this same object, there is nothing wrong with using <code>for()</code> loops.</p>
</blockquote>
<p>One common scenario is to work with different data sources. Here, <code>for()</code> loops can be quite useful. To highlight this, let’s create a few data sources and save them to disk (we will load these again later).</p>
<p>Instead of reusing the same lines of code, we dynamically subset the data, build suitable names for saving and finally save each part of the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## index for start and end rows to be extracted
indx_start &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(diamonds), <span class="dv">2000</span>)
indx_end &lt;-<span class="st"> </span><span class="kw">c</span>(indx_start[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="kw">nrow</span>(diamonds))

## create new directory to save files to
dir_nm &lt;-<span class="st"> &quot;results&quot;</span>
<span class="kw">dir.create</span>(dir_nm, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>)

## looping through the files
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(indx_start)) {
  
  ## actual indeces for current iteration
  st &lt;-<span class="st"> </span>indx_start[i]
  nd &lt;-<span class="st"> </span>indx_end[i]
  
  ## subset data based on row indeces
  dat &lt;-<span class="st"> </span>diamonds[st<span class="op">:</span>nd, ]
  
  ## create unique name for iteration data
  nm &lt;-<span class="st"> </span><span class="kw">paste0</span>(dir_nm, <span class="st">&quot;/&quot;</span>, <span class="st">&quot;diamonds_subset_&quot;</span>, 
               <span class="kw">sprintf</span>(<span class="st">&quot;%05.0f&quot;</span>, st), <span class="st">&quot;_&quot;</span>, 
               <span class="kw">sprintf</span>(<span class="st">&quot;%05.0f&quot;</span>, nd), <span class="st">&quot;.csv&quot;</span>)
  
  ## write to disk
  <span class="kw">write.csv</span>(dat, nm, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)
}</code></pre></div>
<p><code>for()</code> loops are great for iterative operations that do not require assignment of their output to an object, e.g. the example above of saving data or producing plots. If we want the outcome of a loop to be assigned to an object and use this for further analysis, R has much more convenient structures which we will see in the next chapter.</p>
<p>Finally, there are more pieces related to iteration procedures in R:</p>
<ul>
<li><code>while()</code> loops to do something while some condition is met (e.g. while a certain value is below a certain threshold or the like).</li>
<li><code>break</code> allows you to create a condition so that once it is met, the loop will stop.</li>
<li><code>next</code> allows you to create a condition so that if it is met, the execution of the current iteration is skipped and the loop procedes to the next iteration without breaking the loop.</li>
<li>Finally, <code>if</code>-statements can also be helpful to prevent errors within loops.</li>
</ul>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="iteration-procedures.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-apply-family.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
