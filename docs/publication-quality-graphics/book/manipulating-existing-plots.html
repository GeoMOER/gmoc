<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Creating Publication Quality Graphics in R</title>
  <meta name="description" content="Creating Publication Quality Graphics in R">
  <meta name="generator" content="bookdown 0.5.4 and GitBook 2.6.7">

  <meta property="og:title" content="Creating Publication Quality Graphics in R" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="marburg-open-courseware/publication-quality-graphics" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Creating Publication Quality Graphics in R" />
  
  
  

<meta name="author" content="Tim Appelhans and Florian Detsch">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="multiple-plots-per-page.html">
<link rel="next" href="saving.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Publication Quality Graphics in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="data-handling.html"><a href="data-handling.html"><i class="fa fa-check"></i><b>1</b> Data Handling</a><ul>
<li class="chapter" data-level="1.1" data-path="subset.html"><a href="subset.html"><i class="fa fa-check"></i><b>1.1</b> Subsetting Data</a></li>
<li class="chapter" data-level="1.2" data-path="aggregating-data.html"><a href="aggregating-data.html"><i class="fa fa-check"></i><b>1.2</b> Aggregating Data</a></li>
<li class="chapter" data-level="1.3" data-path="sorting-data.html"><a href="sorting-data.html"><i class="fa fa-check"></i><b>1.3</b> Sorting Data</a></li>
<li class="chapter" data-level="1.4" data-path="merging-data.html"><a href="merging-data.html"><i class="fa fa-check"></i><b>1.4</b> Merging Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="a-brief-note-on-using-colors.html"><a href="a-brief-note-on-using-colors.html"><i class="fa fa-check"></i><b>2</b> A Brief Note on using Colors</a></li>
<li class="chapter" data-level="3" data-path="data-visualization.html"><a href="data-visualization.html"><i class="fa fa-check"></i><b>3</b> Data Visualization</a><ul>
<li class="chapter" data-level="3.1" data-path="scatter-plots-lattice.html"><a href="scatter-plots-lattice.html"><i class="fa fa-check"></i><b>3.1</b> Scatter plots (lattice)</a></li>
<li class="chapter" data-level="3.2" data-path="scatter-plots-ggplot2.html"><a href="scatter-plots-ggplot2.html"><i class="fa fa-check"></i><b>3.2</b> Scatter plots (ggplot2)</a></li>
<li class="chapter" data-level="3.3" data-path="box-and-whisker-plots-lattice.html"><a href="box-and-whisker-plots-lattice.html"><i class="fa fa-check"></i><b>3.3</b> Box-and-Whisker Plots (lattice)</a></li>
<li class="chapter" data-level="3.4" data-path="box-and-whisker-plots-ggplot2.html"><a href="box-and-whisker-plots-ggplot2.html"><i class="fa fa-check"></i><b>3.4</b> Box-and-Whisker Plots (ggplot2)</a></li>
<li class="chapter" data-level="3.5" data-path="histograms-and-density-plots-lattice.html"><a href="histograms-and-density-plots-lattice.html"><i class="fa fa-check"></i><b>3.5</b> Histograms and Density Plots (lattice)</a></li>
<li class="chapter" data-level="3.6" data-path="histograms-and-density-plots-ggplot2.html"><a href="histograms-and-density-plots-ggplot2.html"><i class="fa fa-check"></i><b>3.6</b> Histograms and Density Plots (ggplot2)</a></li>
<li class="chapter" data-level="3.7" data-path="plotting-error-bars-lattice.html"><a href="plotting-error-bars-lattice.html"><i class="fa fa-check"></i><b>3.7</b> Plotting Error Bars (lattice)</a></li>
<li class="chapter" data-level="3.8" data-path="gg-error.html"><a href="gg-error.html"><i class="fa fa-check"></i><b>3.8</b> Plotting Error Bars (ggplot2)</a></li>
<li class="chapter" data-level="3.9" data-path="plotting-error-bars-base-graphics.html"><a href="plotting-error-bars-base-graphics.html"><i class="fa fa-check"></i><b>3.9</b> Plotting Error Bars (base graphics)</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="manipulating-plots-with-grid.html"><a href="manipulating-plots-with-grid.html"><i class="fa fa-check"></i><b>4</b> Manipulating Plots with grid</a><ul>
<li class="chapter" data-level="4.1" data-path="multiple-plots-per-page.html"><a href="multiple-plots-per-page.html"><i class="fa fa-check"></i><b>4.1</b> Multiple Plots per Page</a></li>
<li class="chapter" data-level="4.2" data-path="manipulating-existing-plots.html"><a href="manipulating-existing-plots.html"><i class="fa fa-check"></i><b>4.2</b> Manipulating Existing Plots</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="saving.html"><a href="saving.html"><i class="fa fa-check"></i><b>5</b> Saving your Visualizations</a><ul>
<li class="chapter" data-level="5.1" data-path="tagged-image-file-format.html"><a href="tagged-image-file-format.html"><i class="fa fa-check"></i><b>5.1</b> Tagged Image File Format</a></li>
<li class="chapter" data-level="5.2" data-path="portable-network-graphics.html"><a href="portable-network-graphics.html"><i class="fa fa-check"></i><b>5.2</b> Portable Network Graphics</a></li>
<li class="chapter" data-level="5.3" data-path="encapsulated-postscript.html"><a href="encapsulated-postscript.html"><i class="fa fa-check"></i><b>5.3</b> Encapsulated Postscript</a></li>
<li class="chapter" data-level="5.4" data-path="portable-document-format.html"><a href="portable-document-format.html"><i class="fa fa-check"></i><b>5.4</b> Portable Document Format</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="final-remarks.html"><a href="final-remarks.html"><i class="fa fa-check"></i><b>6</b> Final remarks</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with <b>bookdown</b></a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Creating Publication Quality Graphics in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="manipulating-existing-plots" class="section level2">
<h2><span class="header-section-number">4.2</span> Manipulating Existing Plots</h2>
<p>Another application of <strong>grid</strong> is to manipulate an existing plot object. You may have noted that our version of the 2-dimensional density scatter plot produced with <strong>lattice</strong> lacks a color key. Looking at the <strong>ggplot2</strong> version of the density scatter, by contrast, we see that this one already has a color key which is placed to the right of the main plot.</p>
<p>As regards the <strong>lattice</strong> version, a color key can be easily added using <strong>grid</strong>. Since <strong>lattice</strong> is built upon <strong>grid</strong>, it produces a lot of viewports in the creation of the plots (like our scatter plot). After these have been set up, we can navigate to each of them and edit (or delete) them or add new stuff. Given that we have five panels, we actually have some ‘white’ space left in the bottom-right corner that we could use for the color key placement, thus making better use of the available space…</p>
<p>In order to do so, we need to know into which of the viewports we need to navigate. Luckily, <strong>lattice</strong> provides a structured naming convention for its viewports, which makes navigating between single viewports rather easy. Since we are interested in the area covered by the main figure only, we will use <code>trellis.vpname(&quot;figure&quot;)</code> to extract the name of the corresponding viewport and pass this on to <code>downViewport()</code> in order to navigate to it. You will notice that this is very similar to <code>pushViewport()</code>, except for the target viewport being already there.</p>
<p>Like that, we can set up a new viewport in the main plotting area (the ‘figure’ viewport) to make use of the existing white space. Remember that the default units of <strong>grid</strong> range from 0 to 1. This means that we can easily calculate the necessary viewport dimensions. Let’s see how this is done (note that we are actually creating two new viewports in the figure area, one for the color key and another one for the color key label).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_theme &lt;-<span class="st"> </span><span class="kw">trellis.par.get</span>()
my_theme<span class="op">$</span>strip.background<span class="op">$</span>col &lt;-<span class="st"> &quot;grey80&quot;</span>
my_theme<span class="op">$</span>plot.symbol<span class="op">$</span>pch &lt;-<span class="st"> </span><span class="dv">16</span>
my_theme<span class="op">$</span>plot.symbol<span class="op">$</span>col &lt;-<span class="st"> &quot;grey60&quot;</span>
my_theme<span class="op">$</span>plot.polygon<span class="op">$</span>col &lt;-<span class="st"> &quot;grey90&quot;</span>

scatter_lattice &lt;-<span class="st"> </span><span class="kw">xyplot</span>(price <span class="op">~</span><span class="st"> </span>carat <span class="op">|</span><span class="st"> </span>cut, 
                          <span class="dt">data =</span> diamonds, 
                          <span class="dt">panel =</span> <span class="cf">function</span>(x, y, ...) {
                            <span class="kw">panel.xyplot</span>(x, y, ...)
                            lm1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x)
                            lm1sum &lt;-<span class="st"> </span><span class="kw">summary</span>(lm1)
                            r2 &lt;-<span class="st"> </span>lm1sum<span class="op">$</span>adj.r.squared
                            <span class="kw">panel.text</span>(<span class="dt">labels =</span> 
                                         <span class="kw">bquote</span>(<span class="kw">italic</span>(R)<span class="op">^</span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span>
<span class="st">                                                  </span>.(<span class="kw">format</span>(r2, 
                                                           <span class="dt">digits =</span> <span class="dv">3</span>))),
                                       <span class="dt">x =</span> <span class="dv">4</span>, <span class="dt">y =</span> <span class="dv">1000</span>)
                            <span class="kw">panel.smoother</span>(x, y, <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, 
                                           <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, 
                                           <span class="dt">col.se =</span> <span class="st">&quot;black&quot;</span>,
                                           <span class="dt">alpha.se =</span> <span class="fl">0.3</span>)
                            },
                          <span class="dt">xscale.components =</span> xscale.components.subticks,
                          <span class="dt">yscale.components =</span> yscale.components.subticks,
                          <span class="dt">as.table =</span> <span class="ot">TRUE</span>)

l_sc &lt;-<span class="st"> </span><span class="kw">update</span>(scatter_lattice, <span class="dt">par.settings =</span> my_theme)
xy &lt;-<span class="st"> </span><span class="kw">kde2d</span>(<span class="dt">x =</span> diamonds<span class="op">$</span>carat, <span class="dt">y =</span> diamonds<span class="op">$</span>price, <span class="dt">n =</span> <span class="dv">100</span>) 
xy_tr &lt;-<span class="st"> </span><span class="kw">con2tr</span>(xy)
offset &lt;-<span class="st"> </span><span class="kw">max</span>(xy_tr<span class="op">$</span>z) <span class="op">*</span><span class="st"> </span><span class="fl">0.2</span>
z_range &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(xy_tr<span class="op">$</span>z), <span class="kw">max</span>(xy_tr<span class="op">$</span>z) <span class="op">+</span><span class="st"> </span>offset, offset <span class="op">*</span><span class="st"> </span><span class="fl">0.01</span>)

l_sc &lt;-<span class="st"> </span><span class="kw">update</span>(scatter_lattice, <span class="dt">aspect =</span> <span class="dv">1</span>, <span class="dt">par.settings =</span> my_theme, 
               <span class="dt">between =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="fl">0.3</span>, <span class="dt">y =</span> <span class="fl">0.3</span>),
               <span class="dt">panel=</span><span class="cf">function</span>(x,y) {
                 xy &lt;-<span class="st"> </span><span class="kw">kde2d</span>(x,y, <span class="dt">n =</span> <span class="dv">100</span>) 
                 xy_tr &lt;-<span class="st"> </span><span class="kw">con2tr</span>(xy)                 
                 <span class="kw">panel.levelplot</span>(xy_tr<span class="op">$</span>x, xy_tr<span class="op">$</span>y, xy_tr<span class="op">$</span>z, <span class="dt">asp =</span> <span class="dv">1</span>,
                                 <span class="dt">subscripts =</span> <span class="kw">seq</span>(<span class="kw">nrow</span>(xy_tr)), 
                                 <span class="dt">contour =</span> <span class="ot">FALSE</span>, <span class="dt">region =</span> <span class="ot">TRUE</span>, 
                                 <span class="dt">col.regions =</span> <span class="kw">c</span>(<span class="st">&quot;white&quot;</span>, 
                                                 <span class="kw">rev</span>(<span class="kw">clrs_hcl</span>(<span class="dv">10000</span>))),
                                 <span class="dt">at =</span> z_range)
                 lm1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x)
                 lm1sum &lt;-<span class="st"> </span><span class="kw">summary</span>(lm1)
                 r2 &lt;-<span class="st"> </span>lm1sum<span class="op">$</span>adj.r.squared
                 <span class="kw">panel.abline</span>(<span class="dt">a =</span> lm1<span class="op">$</span>coefficients[<span class="dv">1</span>], 
                              <span class="dt">b =</span> lm1<span class="op">$</span>coefficients[<span class="dv">2</span>])
                 <span class="kw">panel.text</span>(<span class="dt">labels =</span> 
                              <span class="kw">bquote</span>(<span class="kw">italic</span>(R)<span class="op">^</span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span>
<span class="st">                                       </span>.(<span class="kw">format</span>(r2, <span class="dt">digits =</span> <span class="dv">3</span>))),
                            <span class="dt">x =</span> <span class="dv">4</span>, <span class="dt">y =</span> <span class="dv">1000</span>)
                 <span class="co">#panel.xyplot(x,y) </span>
                 } 
               ) 


<span class="kw">grid.newpage</span>()
<span class="co">#grid.rect()</span>
<span class="kw">print</span>(l_sc, <span class="dt">newpage =</span> <span class="ot">FALSE</span>)
<span class="co">#grid.rect()</span>
<span class="kw">downViewport</span>(<span class="kw">trellis.vpname</span>(<span class="dt">name =</span> <span class="st">&quot;figure&quot;</span>))
<span class="co">#grid.rect()</span>
vp1 &lt;-<span class="st"> </span><span class="kw">viewport</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">0</span>, 
                <span class="dt">height =</span> <span class="fl">0.5</span>, <span class="dt">width =</span> <span class="fl">0.3</span>,
                <span class="dt">just =</span> <span class="kw">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>),
                <span class="dt">name =</span> <span class="st">&quot;legend.vp&quot;</span>)

<span class="kw">pushViewport</span>(vp1)
<span class="co">#grid.rect()</span>

vp1_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">viewport</span>(<span class="dt">x =</span> <span class="fl">0.2</span>, <span class="dt">y =</span> <span class="fl">0.5</span>, 
                  <span class="dt">height =</span> <span class="fl">0.7</span>, <span class="dt">width =</span> <span class="fl">0.5</span>,
                  <span class="dt">just =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;centre&quot;</span>),
                  <span class="dt">name =</span> <span class="st">&quot;legend.key&quot;</span>)

<span class="kw">pushViewport</span>(vp1_<span class="dv">1</span>)
<span class="co">#grid.rect()</span>

key &lt;-<span class="st"> </span><span class="kw">draw.colorkey</span>(<span class="dt">key =</span> <span class="kw">list</span>(<span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;white&quot;</span>, <span class="kw">rev</span>(<span class="kw">clrs_hcl</span>(<span class="dv">10000</span>))),
                                <span class="dt">at =</span> z_range), <span class="dt">draw =</span> <span class="ot">TRUE</span>)

<span class="kw">seekViewport</span>(<span class="st">&quot;legend.vp&quot;</span>)
<span class="co">#grid.rect()</span>
vp1_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">viewport</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="fl">0.5</span>, 
                  <span class="dt">height =</span> <span class="dv">1</span>, <span class="dt">width =</span> <span class="fl">0.3</span>,
                  <span class="dt">just =</span> <span class="kw">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;centre&quot;</span>),
                  <span class="dt">name =</span> <span class="st">&quot;legend.text&quot;</span>, <span class="dt">angle =</span> <span class="dv">0</span>)

<span class="kw">pushViewport</span>(vp1_<span class="dv">2</span>)
<span class="co">#grid.rect()</span>

<span class="kw">grid.text</span>(<span class="st">&quot;estimated point density&quot;</span>, 
          <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="fl">0.5</span>, <span class="dt">rot =</span> <span class="dv">270</span>, 
          <span class="dt">just =</span> <span class="kw">c</span>(<span class="st">&quot;centre&quot;</span>, <span class="st">&quot;bottom&quot;</span>))

<span class="kw">upViewport</span>(<span class="dv">3</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:grid-manipulate"></span>
<img src="main_files/figure-html/grid-manipulate-1.svg" alt="Using **grid** to add a color key to an existing **lattice** plot object." width="960" />
<p class="caption">
Figure 4.6: Using <strong>grid</strong> to add a color key to an existing <strong>lattice</strong> plot object.
</p>
</div>
<p>Not too complicated, is it? And, in comparison to the <strong>ggplot2</strong> version, we are utilizing the available space a bit more efficiently. Though, obviously, we could also manipulate the <strong>ggplot2</strong> density scatter plot (or any other plot) in a similar manner. In general, we hope that it has become clear just how useful <strong>grid</strong> can be and how it provides us with tools which enable us to produce individual graphics that satisfy our needs.</p>
<p>So far, we have put our efforts into plot creation and learned about a variety of tools that can help us achieve what we want. As a next logical step, let’s see how we can save our graphics to our hard drive.</p>

</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="multiple-plots-per-page.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="saving.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
